# Receipt Protocol Specification (v2.1)

> ðŸ›°ï¸ VOID PROTOCOL v2.1 | Tiny Innovation Group Ltd
>
> Authority: Tiny Innovation Group Ltd
>
> License: Apache 2.0
>
> Status: Authenticated Clean Room Spec
>
> **Endianness:** CCSDS Header (Big-Endian) | Payload (Little-Endian)
>
> **Optimization:** 64-bit machine cycle alignment (Rule of 8)
>
> **Architecture:** Encrypted Store-and-Forward

## 1. Architecture Overview

The Receipt Protocol provides cryptographic "Proof of Execution" to confirm service delivery after payment settlement.

1. **Sat A (Seller):** Signs **Packet C** confirming service success.
2. **Sat B (Mule):** Encapsulates Packet C into **Packet D** for downlink.
3. **Ground Station:** Validates Sat A's execution signature to close the escrow loop.

---

## 2. Packet C: "The Receipt" (104 Bytes)

_Generated by Sat A. Optimized for 8-byte boundary alignment._

| Offset      | Field        | Type     | Size | Endian     | Description                              |
| ----------- | ------------ | -------- | ---- | ---------- | ---------------------------------------- |
| **00-05**   | `ccsds_pri`  | `u8[6]`  | 6B   | **Big**    | Primary Header (APID = Sat A)            |
| **06-07**   | `_pad_head`  | `u16`    | 2B   | -          | **Cycle Alignment Pad**                  |
| **08-15**   | `ccsds_sec`  | `u64`    | 8B   | **Little** | Timestamp: Execution Time                |
| **16-23**   | `enc_tx_id`  | `u64`    | 8B   | **Little** | **CIPHER:** Matches Tunnel `BLOCK_NONCE` |
| **24**      | `enc_status` | `u8`     | 1B   | **Little** | **CIPHER:** 0x01=Success                 |
| **25-31**   | `_pad_sig`   | `u8[7]`  | 7B   | -          | **CIPHER:** Alignment for Signature      |
| **32-95**   | `signature`  | `u8[64]` | 64B  | -          | **Sat A PUF Signature** (Signs 00-31)    |
| **96-99**   | `crc32`      | `u32`    | 4B   | **Little** | Integrity Check                          |
| **100-103** | `_tail_pad`  | `u8[4]`  | 4B   | -          | **Final alignment to 104B**              |

---

## 3. Packet D: "The Delivery" (128 Bytes)

_Generated by Sat B. Optimized for radio FIFO (Power of 2)._

| Offset      | Field        | Type     | Size | Endian     | Description                            |
| ----------- | ------------ | -------- | ---- | ---------- | -------------------------------------- |
| **00-05**   | `ccsds_pri`  | `u8[6]`  | 6B   | **Big**    | Header (APID = Sat B)                  |
| **06-07**   | `_pad_head`  | `u16`    | 2B   | -          | **Cycle Alignment Pad**                |
| **08-15**   | `ccsds_sec`  | `u64`    | 8B   | **Little** | Timestamp: Downlink Time               |
| **16-19**   | `sat_b_id`   | `u32`    | 4B   | **Little** | Carrier ID (Sat B)                     |
| **20-117**  | `payload`    | `u8[98]` | 98B  | -          | **STRIPPED PACKET C** (Header removed) |
| **118-121** | `global_crc` | `u32`    | 4B   | **Little** | Outer Integrity Check                  |
| **122-127** | `_tail`      | `u8[6]`  | 6B   | -          | **Final alignment to 128B**            |

---

## 4. Verification Flow

To close the transaction loop, the Ground Station performs a multi-stage validation once Packet D is received.

### 4.1 Executor Validation (Inner Layer)

The Ground Station must prove that the service was dispensed by the specific Seller (Sat A):

- **Payload Extraction:** Extract the 98-byte `payload` from Packet D.
- **Message Reconstruction:** Reassemble the original signed context using the `APID` from the inner `ccsds_pri` header and the decrypted status fields.
- **PUF Signature Check:** Verify the 64-byte `signature` using **Sat Aâ€™s Public Key** (retrieved from the Authority database via Sat A's ID).
- **Result:** If valid, this confirms Sat Aâ€”and only Sat Aâ€”signed this specific execution receipt.

### 4.2 Logic & Escrow Check

Once the identity is verified, the Ground Station performs the final settlement logic:

- **Transaction Linkage:** The decrypted `enc_tx_id` (u64) is compared against the `BLOCK_NONCE` of the original payment intent in the Ground Station database.
- **Status Update:** If the `tx_id` matches a pending transaction, that transaction is marked as **COMPLETED**.
- **Fund Release:** The Ground Station triggers the final release of funds from the Escrow Smart Contract to Sat Aâ€™s wallet.

---

## 5. Implementation Logic (Mule Deduplication)

Sat B must manage a circular queue of **10 Receipts** (~1.3 KB).

1. **Peeking:** Sat B decrypts `enc_tx_id` using the Shared Key to check for duplicates in the queue.
2. **Flooding Protection:** If the `tx_id` is already present, the packet is discarded immediately.
3. **Encapsulation:** New receipts are wrapped in Packet D and prioritized for Ground Station downlink.

---

[END OF SPECIFICATION]

Verified for 32/64-bit cycle optimization.

Â© 2026 Tiny Innovation Group Ltd.
